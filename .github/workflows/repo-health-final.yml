name: "ULTIMATE-HEALTH-CHECK-FIX"
on:
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: read
      contents: read
    steps:
      - name: Get Repo Data and Create Issue
        uses: actions/github-script@v7
        with:
          script: |
            // 1. Get Branches
            const branches = await github.rest.repos.listBranches({
              owner: context.repo.owner,
              repo: context.repo.repo,
            });
            const branchNames = branches.data.map(b => b.name).join('\n- ');

            // 2. Get Pull Requests
            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
            });
            const prList = prs.data.length > 0 
              ? prs.data.map(p => `#${p.number}: ${p.title}`).join('\n- ')
              : 'No open PRs';

            // 3. Create the Issue
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '[AI-Report] Repository Health Summary',
              body: `### Branch List:\n- ${branchNames}\n\n### Open Pull Requests:\n- ${prList}`
            });